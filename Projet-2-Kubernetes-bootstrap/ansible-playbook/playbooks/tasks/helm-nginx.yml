---
- name: Add ingress-nginx Helm repository
  kubernetes.core.helm_repository:
    name: ingress-nginx
    repo_url: https://kubernetes.github.io/ingress-nginx
    state: present
    force_update: true
  tags:
  - nginx
  - helm
- name: Install or upgrade ingress-nginx with hostNetwork
  kubernetes.core.helm:
    name: ingress-nginx
    chart_ref: ingress-nginx/ingress-nginx
    kubeconfig: "{{ kubeconfig_file }}"
    namespace: ingress-nginx
    create_namespace: true
    values:
      controller:
        hostNetwork: true
        hostPort:
          enabled: true
        kind: DaemonSet
        service:
          type: ""
        dnsPolicy: ClusterFirstWithHostNet
    state: present
  tags:
  - nginx
  - helm
